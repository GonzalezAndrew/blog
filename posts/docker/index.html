<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#68829c"><meta name=msapplication-TileColor content="#68829c"><meta itemprop=name content="Legos Docker Container"><meta itemprop=description content="Introduction Lately due to current circumstances, I have been slowly getting adjusted to working from home. The main challenges I have found from adjusting to my new work environment, was having to constantly transition my development between my work machine, personal macbook air, windows gaming pc, and my linux box. Having the proper binaries or packages I use between each machine become a chore, I constantly ran into version issues with Terraform or just did not have a particular binary installed."><meta itemprop=datePublished content="2020-10-21T00:00:00+00:00"><meta itemprop=dateModified content="2020-10-21T00:00:00+00:00"><meta itemprop=wordCount content="751"><meta itemprop=keywords content="docker,terraform,ansible,automation,"><meta property="og:title" content="Legos Docker Container"><meta property="og:description" content="Introduction Lately due to current circumstances, I have been slowly getting adjusted to working from home. The main challenges I have found from adjusting to my new work environment, was having to constantly transition my development between my work machine, personal macbook air, windows gaming pc, and my linux box. Having the proper binaries or packages I use between each machine become a chore, I constantly ran into version issues with Terraform or just did not have a particular binary installed."><meta property="og:type" content="article"><meta property="og:url" content="https://www.gonzalezandrew.com/posts/docker/"><meta property="article:published_time" content="2020-10-21T00:00:00+00:00"><meta property="article:modified_time" content="2020-10-21T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Legos Docker Container"><meta name=twitter:description content="Introduction Lately due to current circumstances, I have been slowly getting adjusted to working from home. The main challenges I have found from adjusting to my new work environment, was having to constantly transition my development between my work machine, personal macbook air, windows gaming pc, and my linux box. Having the proper binaries or packages I use between each machine become a chore, I constantly ran into version issues with Terraform or just did not have a particular binary installed."><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><title>Legos Docker Container</title><link rel=stylesheet href=https://www.gonzalezandrew.com/css/style.min.dde859928ee7600ec905423b4f055aba03bcce8d54d32646e53869e036638eec.css integrity="sha256-3ehZko7nYA7JBUI7TwVaugO8zo1U0yZG5Thp4DZjjuw=" crossorigin=anonymous></head><body id=page><header id=site-header class="animated slideInUp"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://www.gonzalezandrew.com/>Andrew Gonzalez</a></div><nav class="site-nav hide-in-mobile"><a href=https://www.gonzalezandrew.com/posts/>Posts</a>
<a href=https://www.gonzalezandrew.com/about-hugo/>About</a></nav></div><div class="hdr-right hdr-icons"><button id=toc-btn class="hdr-btn desktop-only-ib" title="Table of Contents"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3" y2="6"/><line x1="3" y1="12" x2="3" y2="12"/><line x1="3" y1="18" x2="3" y2="18"/></svg></button><span class="hdr-social hide-in-mobile"><a href=https://twitter.com/_GonzalezAndrew target=_blank rel="noopener me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=https://www.linkedin.com/in/-andrew-gonzalez/ target=_blank rel="noopener me" title=Linkedin><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a><a href=https://github.com/GonzalezAndrew target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://www.gonzalezandrew.com/posts/>Posts</a></li><li><a href=https://www.gonzalezandrew.com/about-hugo/>About</a></li></ul></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>Oct 21, 2020</span></div><h1>Legos Docker Container</h1></header><div class=content><h1 id=introduction>Introduction<a href=#introduction class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h1><p>Lately due to current circumstances, I have been slowly getting adjusted to working from home. The main challenges I have found from adjusting to my new work environment, was having to constantly transition my development between my work machine, personal macbook air, windows gaming pc, and my linux box. Having the proper binaries or packages I use between each machine become a chore, I constantly ran into version issues with Terraform or just did not have a particular binary installed.</p><h1 id=brainstorm>Brainstorm<a href=#brainstorm class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h1><p>I came up with a small list of possible solutions that I could possible use to help myself avoid running into some of the issues I explained above.</p><h2 id=custom-cli>Custom CLI<a href=#custom-cli class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>The first idea I had was to create a cli wrapper using go, which would &lsquo;wrap&rsquo; all other binaries and allow me to invoke a specific tool when given the appropriate argument. The main reason for this idea was to give myself an excuse to finally learn go and to experiment with the various Hashicorp tools that are natively written using go. I decided not to pursue this idea due to the large number of packages I used daily that are written using other various programming languages such as Ansible or Molecule.</p><h2 id=ansible-roles>Ansible Roles<a href=#ansible-roles class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>The second idea I drafted up was the use of <a href=https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html>Ansible roles</a> to provision my machines. This idea would have been great for it would allow me to better stretch my understanding of Ansible across different distrubtions. Along with using Ansible to download packages, I could use Ansible to provision features such as dotfiles or download applications across all my machines. Unfortunately, I decided to move on from this idea due to the fact that I wanted a quick solution that I could write up in hours. I do plan on revisiting this idea over the upcoming winter season for this solution will give me greater reach in customization.</p><h2 id=docker-container>Docker Container<a href=#docker-container class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>I ended up landing on the idea of using Docker to help solve my problems. Using Docker allows me to easily share the container on any machine that has Docker installed. Additionally, I could use a simple bash script to further abstract the docker commands and arguments to help aid the speed of executing each individual binary that would be installed on the Docker container.</p><h1 id=the-legos-container>The Legos Container<a href=#the-legos-container class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h1><p>I wanted to design the Legos container to be my swiss army knife that I could carry with me in any distribution or machine. I also wanted Legos to be sharable to anyone in any environment.</p><p>At the core, Legos has a small number of packages installed but I do plan on adding addditional packages and features to help enrich the containers usabillity. Currently the packages that are avaliable on Legos are as follows:</p><ul><li><a href=https://www.terraform.io/>terraform</a>: Used for provisioning cloud resources on a almost every cloud provider.</li><li><a href=https://aws.amazon.com/cli/>aws-cli</a>: Used for interacting with the AWS API directly.</li><li><a href=https://www.packer.io/>packer</a>: Used to build machine or docker images.</li><li><a href=https://www.vaultproject.io/>vault</a>: Used as a secrets management tool.</li><li><a href=https://www.ansible.com/>ansible</a>: Used to automate cloud resources, application development, intra-service orchestration and much more.</li></ul><h1 id=expanding-legos-further>Expanding Legos Further<a href=#expanding-legos-further class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h1><p>As I explained above, I wanted to expand the Legos container further with the aid of bash. I wanted to have the ability to call the container quickly and not have to manually type in a larger <code>docker run</code> command. I came up with the bash function below that helped me get over this hurtle and can be placed in your <code>~/.bashrc</code> or wherever you store your additional sourced bash functions.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>legos<span class=o>(){</span>
    <span class=nb>local</span> <span class=nv>key</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=si>}</span>
    <span class=k>case</span> <span class=nv>$1</span> in
        <span class=s2>&#34;ansible&#34;</span><span class=o>)</span>
        <span class=nv>bin</span><span class=o>=</span><span class=nv>$1</span>
        <span class=nb>shift</span>
        <span class=p>;;</span>
        <span class=s2>&#34;terraform&#34;</span><span class=o>)</span>
        <span class=nv>bin</span><span class=o>=</span><span class=nv>$1</span>
        <span class=nb>shift</span>
        <span class=p>;;</span>
        <span class=s2>&#34;vault&#34;</span><span class=o>)</span>
        <span class=nv>bin</span><span class=o>=</span><span class=nv>$1</span>
        <span class=nb>shift</span>
        <span class=p>;;</span>
        <span class=s2>&#34;packer&#34;</span><span class=o>)</span>
        <span class=nv>bin</span><span class=o>=</span><span class=nv>$1</span>
        <span class=nb>shift</span>
        <span class=p>;;</span>
        <span class=s2>&#34;aws&#34;</span><span class=o>)</span>
        <span class=nv>bin</span><span class=o>=</span><span class=nv>$1</span>
        <span class=nb>shift</span>
        <span class=p>;;</span>
        *<span class=o>)</span>
        <span class=nb>echo</span> <span class=s2>&#34;Unrecognized option: </span><span class=nv>$key</span><span class=s2>&#34;</span>
        <span class=nb>exit</span> <span class=m>1</span>
    <span class=k>esac</span>

    docker run --rm <span class=se>\
</span><span class=se></span>        -w /tmp <span class=se>\
</span><span class=se></span>        -v <span class=k>$(</span><span class=nb>pwd</span><span class=k>)</span>:/tmp/ <span class=se>\
</span><span class=se></span>        -v ~/.aws/:/root/aws <span class=se>\
</span><span class=se></span>        -v ~/.ssh:/root/.ssh <span class=se>\
</span><span class=se></span>        andrewgonzo/legos:latest <span class=s2>&#34;</span><span class=nv>$bin</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
<span class=o>}</span>
</code></pre></div><p>As you can see, the function <code>legos</code> allows me to easily call a binary that is installed in the Legos container without having to type in the long <code>docker run</code> command that follows the case statement. I decided to add both the <code>~/.ssh</code> and <code>~/.aws</code> directory to allow myself to use my credentials when I need them. Of course, you can change this function to fit your needs such as adding additonal arguments.</p><p>If you are interested in Legos, please visit my <a href=https://github.com/GonzalezAndrew/docker-apps/tree/master/legos>GitHub repoistory</a> where I store all my Docker containers. If you have suggestions on how I could to make Legos better, I would love to hear them or please contribute to the repository.</p></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-feather"><path d="M20.24 12.24a6 6 0 00-8.49-8.49L5 10.5V19h8.5z"/><line x1="16" y1="8" x2="2" y2="22"/><line x1="17.5" y1="15" x2="9" y2="15"/></svg>Andrew Gonzalez</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://www.gonzalezandrew.com/tags/docker>docker</a></span><span class=tag><a href=https://www.gonzalezandrew.com/tags/terraform>terraform</a></span><span class=tag><a href=https://www.gonzalezandrew.com/tags/ansible>ansible</a></span><span class=tag><a href=https://www.gonzalezandrew.com/tags/automation>automation</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>751 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2020-10-21 00:00 +0000</p></footer></article><aside id=toc><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><a href=#custom-cli>Custom CLI</a></li><li><a href=#ansible-roles>Ansible Roles</a></li><li><a href=#docker-container>Docker Container</a></li></ul></nav></aside><div class="post-nav thin"><a class=prev-post href=https://www.gonzalezandrew.com/posts/welcome/><span class=post-nav-label>Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span><br><span>Hello World</span></a></div><div id=comments class=thin><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"andrewgonzalez"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2020 <a href=https://www.gonzalezandrew.com/>Andrew Gonzalez</a></p></footer><script src=https://www.gonzalezandrew.com/js/bundle.min.4a9a0ac3d2217822c7865b4161e6c2a71de1d70492264337755427898dd718f6.js integrity="sha256-SpoKw9IheCLHhltBYebCpx3h1wSSJkM3dVQniY3XGPY=" crossorigin=anonymous></script></body></html>