<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.83.1"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta property="og:title" content="Legos Docker Container"><meta name=author content="Andrew Gonzalez"><meta name=keywords content="docker,terraform,ansible,automation"><meta name=description content="Containerizing Developer Tools"><meta property="og:title" content="Legos Docker Container"><meta property="og:description" content="Containerizing Developer Tools"><meta property="og:type" content="article"><meta property="og:url" content="http://gonzalezandrew.com/posts/docker/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-10-21T00:00:00+00:00"><meta property="article:modified_time" content="2020-10-21T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Legos Docker Container"><meta name=twitter:description content="Containerizing Developer Tools"><link rel=stylesheet type=text/css media=screen href=/css/normalize.css><link rel=stylesheet type=text/css media=screen href=/css/main.css><link rel=stylesheet type=text/css media=screen href=/css/all.css><link rel=stylesheet href=/css/katex.min.css crossorigin=anonymous><script defer src=/js/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script><script defer src=/js/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><link rel=stylesheet type=text/css media=screen href=/css/syntax.css><title>Legos Docker Container | Andrew Gonzalez</title></head><body><header><div id=avatar><a href=http://gonzalezandrew.com/><img src=/images/me.jpg alt="Andrew Gonzalez"></a></div><div id=titletext><h2 id=title><a href=http://gonzalezandrew.com/>Andrew Gonzalez</a></h2></div><div id=title-description><p id=subtitle>DevOps Engineer who has his head stuck in the clouds.</p><div id=social><nav><ul><li><a href=https://github.com/GonzalezAndrew><i title=Github class="icons fab fa-github"></i></a></li><li><a href=https://twitter.com/_GonzalezAndrew><i title=Twitter class="icons fab fa-twitter-square"></i></a></li><li><a href=https://www.linkedin.com/in/-andrew-gonzalez/><i title=LinkedIn class="icons fab fa-linkedin"></i></a></li></ul></nav></div></div><div id=mainmenu><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Blog</a></li><li><a href=/about>About</a></li><li><a href=/tags>Tags</a></li></ul></nav></div></header><main><div class=post><div class=author></div><div class=post-header><div class=meta><div class=date><span class=day>21</span>
<span class=rest>Oct 2020</span></div></div><div class=matter><h1 class=title>Legos Docker Container</h1></div></div><div class=markdown><p><figure><img src=/images/posts/tools.png alt=Example></figure></p><h1 id=introduction>Introduction</h1><p>Lately due to current circumstances, I have been slowly getting adjusted to working from home. The main challenges I have found from adjusting to my new work environment, was having to constantly transition my development between my work machine, personal macbook air, windows gaming pc, and my linux box. Having the proper binaries or packages I use between each machine become a chore, I constantly ran into version issues with Terraform or just did not have a particular binary installed.</p><h1 id=brainstorm>Brainstorm</h1><p>I came up with a small list of possible solutions that I could possible use to help myself avoid running into some of the issues I explained above.</p><h2 id=custom-cli>Custom CLI</h2><p>The first idea I had was to create a cli wrapper using go, which would &lsquo;wrap&rsquo; all other binaries and allow me to invoke a specific tool when given the appropriate argument. The main reason for this idea was to give myself an excuse to finally learn go and to experiment with the various Hashicorp tools that are natively written using go. I decided not to pursue this idea due to the large number of packages I used daily that are written using other various programming languages such as Ansible or Molecule.</p><h2 id=ansible-roles>Ansible Roles</h2><p>The second idea I drafted up was the use of <a href=https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html target=_blank>Ansible roles</a>
to provision my machines. This idea would have been great for it would allow me to better stretch my understanding of Ansible across different distrubtions. Along with using Ansible to download packages, I could use Ansible to provision features such as dotfiles or download applications across all my machines. Unfortunately, I decided to move on from this idea due to the fact that I wanted a quick solution that I could write up in hours. I do plan on revisiting this idea over the upcoming winter season for this solution will give me greater reach in customization.</p><h2 id=docker-container>Docker Container</h2><p>I ended up landing on the idea of using Docker to help solve my problems. Using Docker allows me to easily share the container on any machine that has Docker installed. Additionally, I could use a simple bash script to further abstract the docker commands and arguments to help aid the speed of executing each individual binary that would be installed on the Docker container.</p><h1 id=the-legos-container>The Legos Container</h1><p>I wanted to design the Legos container to be my swiss army knife that I could carry with me in any distribution or machine. I also wanted Legos to be sharable to anyone in any environment.</p><p>At the core, Legos has a small number of packages installed but I do plan on adding addditional packages and features to help enrich the containers usabillity. Currently the packages that are avaliable on Legos are as follows:</p><ul><li><a href=https://www.terraform.io/ target=_blank>terraform</a>
: Used for provisioning cloud resources on a almost every cloud provider.</li><li><a href=https://aws.amazon.com/cli/ target=_blank>aws-cli</a>
: Used for interacting with the AWS API directly.</li><li><a href=https://www.packer.io/ target=_blank>packer</a>
: Used to build machine or docker images.</li><li><a href=https://www.vaultproject.io/ target=_blank>vault</a>
: Used as a secrets management tool.</li><li><a href=https://www.ansible.com/ target=_blank>ansible</a>
: Used to automate cloud resources, application development, intra-service orchestration and much more.</li></ul><h1 id=expanding-legos-further>Expanding Legos Further</h1><p>As I explained above, I wanted to expand the Legos container further with the aid of bash. I wanted to have the ability to call the container quickly and not have to manually type in a larger <code>docker run</code> command. I came up with the bash function below that helped me get over this hurtle and can be placed in your <code>~/.bashrc</code> or wherever you store your additional sourced bash functions.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>legos<span class=o>(){</span>
    <span class=nb>local</span> <span class=nv>key</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=si>}</span>
    <span class=k>case</span> <span class=nv>$1</span> in
        <span class=s2>&#34;ansible&#34;</span><span class=o>)</span>
        <span class=nv>bin</span><span class=o>=</span><span class=nv>$1</span>
        <span class=nb>shift</span>
        <span class=p>;;</span>
        <span class=s2>&#34;terraform&#34;</span><span class=o>)</span>
        <span class=nv>bin</span><span class=o>=</span><span class=nv>$1</span>
        <span class=nb>shift</span>
        <span class=p>;;</span>
        <span class=s2>&#34;vault&#34;</span><span class=o>)</span>
        <span class=nv>bin</span><span class=o>=</span><span class=nv>$1</span>
        <span class=nb>shift</span>
        <span class=p>;;</span>
        <span class=s2>&#34;packer&#34;</span><span class=o>)</span>
        <span class=nv>bin</span><span class=o>=</span><span class=nv>$1</span>
        <span class=nb>shift</span>
        <span class=p>;;</span>
        <span class=s2>&#34;aws&#34;</span><span class=o>)</span>
        <span class=nv>bin</span><span class=o>=</span><span class=nv>$1</span>
        <span class=nb>shift</span>
        <span class=p>;;</span>
        *<span class=o>)</span>
        <span class=nb>echo</span> <span class=s2>&#34;Unrecognized option: </span><span class=nv>$key</span><span class=s2>&#34;</span>
        <span class=nb>exit</span> <span class=m>1</span>
    <span class=k>esac</span>

    docker run --rm <span class=se>\
</span><span class=se></span>        -w /tmp <span class=se>\
</span><span class=se></span>        -v <span class=k>$(</span><span class=nb>pwd</span><span class=k>)</span>:/tmp/ <span class=se>\
</span><span class=se></span>        -v ~/.aws/:/root/aws <span class=se>\
</span><span class=se></span>        -v ~/.ssh:/root/.ssh <span class=se>\
</span><span class=se></span>        andrewgonzo/legos:latest <span class=s2>&#34;</span><span class=nv>$bin</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>As you can see, the function <code>legos</code> allows me to easily call a binary that is installed in the Legos container without having to type in the long <code>docker run</code> command that follows the case statement. I decided to add both the <code>~/.ssh</code> and <code>~/.aws</code> directory to allow myself to use my credentials when I need them. Of course, you can change this function to fit your needs such as adding additonal arguments.</p><p>If you are interested in Legos, please visit my <a href=https://github.com/GonzalezAndrew/docker-apps/tree/master/legos target=_blank>GitHub repoistory</a>
where I store all my Docker containers. If you have suggestions on how I could to make Legos better, I would love to hear them or please contribute to the repository.</p></div><div class=tags><div class=taxosfloating_left><p>Tags</p></div><div class=termsfloating_right><p><a href=/tags/ansible/>ansible</a>
<a href=/tags/automation/>automation</a>
<a href=/tags/docker/>docker</a>
<a href=/tags/terraform/>terraform</a></p></div><div class=clearit></div></div></div></main><footer>© Andrew Gonzalez 2020 - 2021. Powerd by <a href=https://gohugo.io>Hugo</a></footer></body></html>